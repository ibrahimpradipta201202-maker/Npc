<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>NPC Generator Pasien</title>

<style>
body{font-family:Arial,sans-serif;background:#eafaf1}
.card{
  max-width:520px;margin:40px auto;background:#fff;
  padding:20px;border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,.12)
}
h2{color:#27ae60;text-align:center}
button{
  width:100%;padding:12px;border:none;border-radius:10px;
  margin-top:10px;font-size:15px;cursor:pointer
}
.generate{background:#2ecc71;color:#fff}
.confirm{background:#27ae60;color:#fff}
.confirm:disabled{background:#9e9e9e}
.info{
  margin-top:15px;padding:10px;background:#f1fff7;
  border-left:4px solid #2ecc71;font-size:14px
}
.data{margin-top:10px;font-size:14px}
.badge{
  display:inline-block;padding:4px 8px;border-radius:6px;
  font-size:12px;color:#fff
}
.bpjs{background:#16a085}
.umum{background:#2980b9}
</style>
</head>
<body>

<div class="card">
  <h2>ðŸ§‘ NPC Pasien Generator</h2>

  <button class="generate" onclick="buatNPC()">Generate NPC</button>
  <button class="confirm" id="btnKonfirmasi" disabled onclick="konfirmasi()">
    Konfirmasi Masuk RS
  </button>

  <div class="info" id="info">Belum ada NPC</div>
  <div class="data" id="dataNPC"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import {
  getFirestore, collection, addDoc,
  onSnapshot, doc, updateDoc
} from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

/* ðŸ”¥ GANTI CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCLc7nnPwr-GjGoJqhw-DbYEtfw68X9eso",
  authDomain: "rssimulator-rjwl.firebaseapp.com",
  projectId: "rssimulator-rjwl"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let lastId=null;

/* ðŸ‡®ðŸ‡© NAMA */
function randomNamaIndonesia(){
  const pria=["Muhammad","Ahmad","Budi","Agus","Andi","Rizky","Fajar","Dimas","Bayu","Arif","Joko","Bima","Aditya","Farhan","Rama"];
  const wanita=["Siti","Aisyah","Putri","Dewi","Rina","Intan","Nabila","Aulia","Fitri","Nur","Ayu","Citra","Wulan","Sari","Zahra"];
  const tengah=["Aditya","Pratama","Ramadhan","Nur","Fauzan","Hidayat","Kurnia","Mahendra","Maulana","Akbar","Firdaus","Rafi"];
  const belakang=["Saputra","Saputri","Wijaya","Santoso","Lestari","Permata","Utama","Firmansyah","Setiawan","Nugroho","Kusuma","Prakoso"];
  const gender=Math.random()>0.5?"pria":"wanita";
  let n=[];
  n.push(gender==="pria"?pria[Math.floor(Math.random()*pria.length)]:wanita[Math.floor(Math.random()*wanita.length)]);
  if(Math.random()>0.4)n.push(tengah[Math.floor(Math.random()*tengah.length)]);
  if(Math.random()>0.3)n.push(belakang[Math.floor(Math.random()*belakang.length)]);
  return n.join(" ");
}

/* ðŸ†” NIK PALSU */
function randomNIK(umur){
  const kode=["31","32","33","34","35","36","51","52","53","61","62","63","64","71","72","73","74"];
  const prov=kode[Math.floor(Math.random()*kode.length)];
  const t=Math.floor(Math.random()*28)+1;
  const b=Math.floor(Math.random()*12)+1;
  const y=(new Date().getFullYear()-umur).toString().slice(-2);
  const u=Math.floor(1000+Math.random()*9000);
  return prov+t.toString().padStart(2,"0")+b.toString().padStart(2,"0")+y+u;
}

/* ðŸ  ALAMAT */
function randomAlamat(){
  const j=["Jl. Merdeka","Jl. Sudirman","Jl. Ahmad Yani","Jl. Diponegoro","Jl. Veteran","Jl. Kartini"];
  const k=["Sukamaju","Sukamulya","Mekarjaya","Cempaka","Melati","Sejahtera"];
  const kc=["Cibinong","Tambun","Pancoran","Tebet","Sukmajaya","Lowokwaru"];
  const kota=["Jakarta","Bogor","Depok","Bekasi","Bandung","Semarang","Yogyakarta","Surabaya","Malang"];
  const p=["DKI Jakarta","Jawa Barat","Jawa Tengah","DI Yogyakarta","Jawa Timur"];
  return `${j[Math.floor(Math.random()*j.length)]} No.${Math.floor(Math.random()*200)}
  RT ${Math.floor(Math.random()*10)+1}/RW ${Math.floor(Math.random()*10)+1},
  Kel. ${k[Math.floor(Math.random()*k.length)]},
  Kec. ${kc[Math.floor(Math.random()*kc.length)]},
  ${kota[Math.floor(Math.random()*kota.length)]}, ${p[Math.floor(Math.random()*p.length)]}`;
}

/* ðŸ’³ JENIS PASIEN */
function randomPembayaran(){
  if(Math.random()>0.5){
    return {
      jenis:"BPJS",
      badge:"bpjs",
      no:"000"+Math.floor(100000000000+Math.random()*900000000000)
    };
  }else{
    return {
      jenis:"Umum",
      badge:"umum",
      biaya:"Rp "+(Math.floor(Math.random()*900000)+100000).toLocaleString("id-ID")
    };
  }
}

/* ðŸ§‘ BUAT NPC */
window.buatNPC=async()=>{
  const umur=Math.floor(Math.random()*60)+15;
  const nama=randomNamaIndonesia();
  const nik=randomNIK(umur);
  const alamat=randomAlamat();
  const bayar=randomPembayaran();

  const data={
    nama, umur, nik, alamat,
    jenisPasien:bayar.jenis,
    status:"NPC dibuat"
  };

  if(bayar.jenis==="BPJS") data.noBPJS=bayar.no;
  else data.estimasiBiaya=bayar.biaya;

  const ref=await addDoc(collection(db,"pasien"),data);
  lastId=ref.id;

  info.innerText="NPC dibuat. Menunggu resepsionis.";
  dataNPC.innerHTML=`
    <b>Nama:</b> ${nama}<br>
    <b>Umur:</b> ${umur} tahun<br>
    <b>NIK:</b> ${nik}<br>
    <b>Alamat:</b><br>${alamat}<br><br>
    <b>Jenis:</b> <span class="badge ${bayar.badge}">${bayar.jenis}</span><br>
    ${bayar.jenis==="BPJS"
      ? `<b>No BPJS:</b> ${bayar.no}`
      : `<b>Estimasi Biaya:</b> ${bayar.biaya}`
    }<br>
    <b>Status:</b> NPC dibuat
  `;
};

/* ðŸ” STATUS */
onSnapshot(collection(db,"pasien"),snap=>{
  snap.forEach(d=>{
    if(d.id===lastId && d.data().status==="Sudah Terdaftar"){
      btnKonfirmasi.disabled=false;
      info.innerText="Resepsionis sudah mendaftarkan pasien.";
    }
  });
});

/* âœ… KONFIRMASI */
window.konfirmasi=async()=>{
  await updateDoc(doc(db,"pasien",lastId),{status:"Menunggu Dokter"});
  btnKonfirmasi.disabled=true;
  info.innerText="Pasien masuk antrian dokter ðŸ©º";
};
</script>

</body>
</html>
